export default function initCatalog() {
  // Catalog Mobile Funcs
  const catalogData = [
    {
      title: "Наливные полы",
      icon: "/assets/images/icon-catalog-1.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для бетона",
      icon: "/assets/images/icon-catalog-2.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: [
            {
              title: "Грунтовки",
              url: "",
            },
            {
              title: "Грунт-эмали",
              url: "",
            },
            {
              title: "Эмали",
              url: "",
            },
          ],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для металла",
      icon: "/assets/images/icon-catalog-3.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для фасадов",
      icon: "/assets/images/icon-catalog-4.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для дерева",
      icon: "/assets/images/icon-catalog-5.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для крыш",
      icon: "/assets/images/icon-catalog-6.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для асфальта",
      icon: "/assets/images/icon-catalog-7.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Для топинга",
      icon: "/assets/images/icon-catalog-8.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Огнезащитные краски",
      icon: "/assets/images/icon-catalog-9.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "«ЭКО» краски",
      icon: "/assets/images/icon-catalog-10.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Кислотостойкие краски",
      icon: "/assets/images/icon-catalog-11.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
    {
      title: "Промышленные покрытие",
      icon: "/assets/images/icon-catalog-12.svg",
      subcategories: [
        {
          title: "Антикоррозийные материалы",
          items: ["Грунтовки", "Грунт-эмали", "Эмали"],
        },
        {
          title: "Материалы для нефтегазовых сооружений",
          items: [
            {
              title: "Кислотоупорные материалы",
              url: "",
            },
            {
              title: "Химстойкие материалы",
              url: "",
            },
            { title: "Огнезащита", url: "" },
          ],
        },
      ],
    },
  ];

  let menuHistory = [];

  function renderMenu(menuData, title) {
    // Update the catalog title
    document.getElementById("catalogTitle").textContent = title || "Каталог";

    // Get the container to display the menu
    const menuContainer = document.getElementById("menuContainer");
    menuContainer.innerHTML = "";

    // Iterate through menu items and create list elements
    menuData.forEach((menuItem) => {
      const li = document.createElement("li");
      li.className = `fade-in menu-item group cursor-pointer flex items-center gap-5 font-medium leading-[19.5px] hover:text-brand-red hover:bg-brand-gray-100 px-2.5 py-5`;

      // Add the icon if it exists (only for first-level items)
      if (menuItem.icon) {
        const icon = document.createElement("img");
        icon.src = menuItem.icon;
        li.appendChild(icon);
      }

      // Add the menu title inside an anchor tag for items without subcategories
      if (!menuItem.subcategories && !menuItem.items) {
        const anchor = document.createElement("a");
        anchor.href = menuItem.title.url; // Navigate to product.html with the product title in the query string
        anchor.textContent = menuItem.title.title;
        li.appendChild(anchor);

        // Close the catalog when an item is clicked
        anchor.addEventListener("click", closeCatalog);
      } else {
        // Add the menu title
        const titleSpan = document.createElement("span");
        titleSpan.textContent = menuItem.title;
        li.appendChild(titleSpan);
      }

      // Create a submenu container
      const submenu = document.createElement("ul");
      submenu.className = "submenu"; // Add class for transition effect

      li.addEventListener("click", () => {
        if (menuItem.subcategories) {
          // Handle subcategories if they exist
          menuHistory.push({ menuData, title });
          renderMenu(menuItem.subcategories, menuItem.title);
        } else if (menuItem.items) {
          // Render items if present
          menuHistory.push({ menuData, title });
          renderMenu(
            menuItem.items.map((item) => ({ title: item })),
            menuItem.title
          );
        } else {
          // Toggle the submenu for items without subcategories
          submenu.classList.toggle("submenu-open");
        }
      });

      // Add the arrow for navigation
      if (menuItem.subcategories || menuItem.items) {
        const arrow = document.createElement("span");
        arrow.style.marginLeft = "auto";
        arrow.innerHTML = `
          <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="stroke-black group-hover:stroke-brand-red transition-all duration-300">
              <path d="M1 13L6.68539 7.70711C7.10487 7.31658 7.10487 6.68342 6.68539 6.29289L1 1" stroke-width="1.5" stroke-linecap="round"/>
          </svg>`;
        li.appendChild(arrow);
      }

      menuContainer.appendChild(li);
      menuContainer.appendChild(submenu);
    });

    // Show or hide the back button
    const backBtn = document.getElementById("backBtn");
    const backBtnLabel = document.getElementById("backBtnLabel");
    if (menuHistory.length > 0) {
      backBtnLabel.textContent = menuHistory[menuHistory.length - 1].title;
      backBtn.classList.remove("hidden");
    } else {
      backBtn.classList.add("hidden");
    }

    // Show or hide the static menu button
    const menuBtn = document.getElementById("menuBtn");
    menuBtn.classList.toggle("hidden", menuHistory.length > 0);

    // Update "View All" button visibility
    const viewAllBtn = document.getElementById("viewAllBtn");
    if (
      menuData.length > 0 &&
      !menuData[0].subcategories &&
      !menuData[0].items
    ) {
      viewAllBtn.classList.remove("hidden");
    } else {
      viewAllBtn.classList.add("hidden");
    }
  }

  function openCatalog() {
    const catalogElement = document.getElementById("catalogMobile");
    catalogElement.classList.remove("hidden");
    catalogElement.classList.add("catalog-open");
    catalogElement.classList.remove("catalog-closed");
    renderMenu(catalogData, "Каталог");
  }

  function closeCatalog() {
    const catalogElement = document.getElementById("catalogMobile");
    catalogElement.classList.remove("catalog-open");
    catalogElement.classList.add("catalog-closed");
    setTimeout(() => {
      catalogElement.classList.add("hidden");
    }, 300); // Delay to allow for transition
  }

  function goBack() {
    if (menuHistory.length > 0) {
      const previousMenu = menuHistory.pop();
      renderMenu(previousMenu.menuData, previousMenu.title);
    }
  }

  // Event Listeners
  document
    .getElementById("openCatalogBtn")
    .addEventListener("click", openCatalog);
  document
    .getElementById("closeCatalog")
    .addEventListener("click", closeCatalog);
  document.getElementById("menuBtn").addEventListener("click", closeCatalog);
  document.getElementById("backBtn").addEventListener("click", goBack);
}
